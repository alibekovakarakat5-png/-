# ‚úÖ –°—Ç–∞—Ç—É—Å –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–≤–æ–Ω–∫–æ–≤

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### Backend

1. **CallService.processCall()** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏:
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ recordUrl –∏–∑ Bitrix
   - ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ
   - ‚úÖ –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —á–µ—Ä–µ–∑ faster-whisper
   - ‚úÖ –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ OpenAI
   - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î
   - ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤: `new` ‚Üí `in_progress` ‚Üí `audio_downloaded` ‚Üí `transcribed` ‚Üí `analyzed`

2. **CallService.processPendingCalls()** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö pending –∑–≤–æ–Ω–∫–æ–≤:
   - ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∑–≤–æ–Ω–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `new`, `in_progress` –∏–ª–∏ –±–µ–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
   - ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ 50 –∑–≤–æ–Ω–∫–æ–≤ –∑–∞ —Ä–∞–∑
   - ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**:
   - ‚úÖ –ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑ Bitrix –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ñ–æ–Ω–µ
   - ‚úÖ Cron-–∑–∞–¥–∞—á–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç pending –∑–≤–æ–Ω–∫–∏

4. **API Endpoints**:
   - ‚úÖ `POST /api/calls/sync` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - ‚úÖ `POST /api/calls/process-pending` - —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö pending –∑–≤–æ–Ω–∫–æ–≤
   - ‚úÖ `POST /api/calls/:id/process` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞
   - ‚úÖ `GET /api/calls/:id` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–º `analysis`

5. **BitrixService**:
   - ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ recordUrl –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - ‚úÖ –ú–µ—Ç–æ–¥ `getCallInfo` —Ç–µ–ø–µ—Ä—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ CallService

### Frontend

1. **–¢–∞–±–ª–∏—Ü–∞ –∑–≤–æ–Ω–∫–æ–≤**:
   - ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç `scoreOverall` –∏ `riskLevel` –∏–∑ –ë–î
   - ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã: `new`, `in_progress`, `audio_downloaded`, `transcribed`, `analyzed`, `error`
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∏—Å–∫–æ–≤ (low/medium/high)

2. **CallDetails**:
   - ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API
   - ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
   - ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ –ø–æ —Å–µ–∫—Ü–∏—è–º
   - ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å" –¥–ª—è —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω–≤–µ–π–µ—Ä

1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (`POST /api/calls/sync`):
   - –ü–æ–ª—É—á–∞–µ—Ç –∑–≤–æ–Ω–∫–∏ –∏–∑ Bitrix
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `new`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ —Ñ–æ–Ω–µ

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞** (`processCall`):
   - –°—Ç–∞—Ç—É—Å ‚Üí `in_progress`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ recordUrl (–µ—Å–ª–∏ –Ω–µ—Ç)
   - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ ‚Üí —Å—Ç–∞—Ç—É—Å `audio_downloaded`
   - –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ‚Üí —Å—Ç–∞—Ç—É—Å `transcribed`
   - –ê–Ω–∞–ª–∏–∑ ‚Üí —Å—Ç–∞—Ç—É—Å `analyzed`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: `transcriptText`, `analysisJson`, `scoreOverall`, `riskLevel`

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**:
   - Cron –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç pending –∑–≤–æ–Ω–∫–∏
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–æ 50 –∑–≤–æ–Ω–∫–æ–≤ –∑–∞ —Ä–∞–∑

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Call –≤ –ë–î:
- `status`: `new` | `in_progress` | `audio_downloaded` | `transcribed` | `analyzed` | `error`
- `transcriptText`: –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- `analysisJson`: JSON —Å—Ç—Ä–æ–∫–∞ —Å –ø–æ–ª–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º
- `scoreOverall`: 0-100
- `riskLevel`: `low` | `medium` | `high`

### Analysis JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```json
{
  "scores": {
    "greeting": 1-5,
    "needs": 1-5,
    "presentation": 1-5,
    "objections": 1-5,
    "closing": 1-5,
    "tone": 1-5,
    "overall": 0-100
  },
  "sections": {
    "greeting": { "how_it_was": "...", "how_to_improve": "..." },
    ...
  },
  "recommendations": [...],
  "alternative_phrases": [...],
  "script_improvements": [...],
  "summary": "..."
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö pending –∑–≤–æ–Ω–∫–æ–≤:
```powershell
Invoke-WebRequest -Uri http://localhost:8080/api/calls/process-pending -Method POST
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞:
```powershell
Invoke-WebRequest -Uri http://localhost:8080/api/calls/1/process -Method POST
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É):
```powershell
Invoke-WebRequest -Uri http://localhost:8080/api/calls/sync -Method POST
```

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ö–æ–Ω–≤–µ–π–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–≤–æ–Ω–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

